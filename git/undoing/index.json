{
    "content": "<p>Undoing mistakes</p>\n<h1 id=\"find-and-restore-a-deleted-file\">Find and restore a deleted file</h1>\n<p>With the help of <a href=\"http://stackoverflow.com/questions/953481/find-and-restore-a-deleted-file-in-a-git-repo\">StackOverflow</a>:</p>\n<p>Find the last commit that affected the given path. As the file isn't in the HEAD commit, this commit must have deleted it.</p>\n<pre><code class=\"bash\">git rev-list -n 1 HEAD -- &lt;file_path&gt;\n</code></pre>\n\n<p>Then checkout the version at the commit before, using the caret (^) symbol:</p>\n<pre><code class=\"bash\">git checkout &lt;deleting_commit&gt;^ -- &lt;file_path&gt;\n</code></pre>\n\n<p>Or in one command, if <code>$file</code> is the file in question.</p>\n<pre><code class=\"bash\">git checkout $(git rev-list -n 1 HEAD -- &quot;$file&quot;)^ -- &quot;$file&quot;\n</code></pre>\n\n<p><strong>HINT:</strong> Use <code>git log --diff-filter=D --summary</code> to get all the commits which have deleted files and the files deleted;</p>\n<p><strong>HINT 2:</strong> <a href=\"http://blog.kablamo.org/2013/12/08/git-restore/\">from here</a> How to search the contents of deleted files</p>\n<p>Lets say I don\u2019t remember the filename of that file I deleted in a fit of cleanup passion. I do remember the name of one of the functions in it though. Here is how to deal with that. Search the contents of all files that have ever existed in git for a string:</p>\n<pre><code class=\"Bash\">git log --summary -S&lt;string&gt; [&lt;path/to/file&gt;] [--since=2009.1.1] [--until=2010.1.1]\n</code></pre>\n\n<p>Another way to do this:</p>\n<pre><code class=\"Bash\">git rev-list --all | xargs git grep 'string'\n</code></pre>\n\n<h1 id=\"undoing-a-git-rebase\">Undoing a git rebase</h1>\n<p>Sometimes we want to undo a bad <code>git rebase</code>, hints from <a href=\"http://stackoverflow.com/questions/134882/undoing-a-git-rebase\">StackOverflow</a> :</p>\n<ul>\n<li>First, we have to discover where is the head commit of the branch as it was immediately before the rebase started in the reflog:</li>\n</ul>\n<pre><code class=\"Bash\">git reflog\n</code></pre>\n\n<p>or</p>\n<pre><code class=\"Bash\">git log -g\n</code></pre>\n\n<ul>\n<li>Then, reset the current branch to it (with the usual caveats about being absolutely sure before reseting with the --hard option):</li>\n</ul>\n<pre><code class=\"Bash\"># Suppose the old commit was HEAD@{5} in the ref log\ngit reset --hard HEAD@{5}\n</code></pre>\n\n<p><strong>HINT:</strong> Just in case, make a backup first: <code>git tag BACKUP</code>. You can return to it if something goes wrong: <code>git reset --hard BACKUP</code></p>\n<h2 id=\"desfazendo-o-ultimo-commit\">Desfazendo o \u00faltimo commit</h2>\n<pre><code class=\"Bash\">git reset --soft HEAD~1\n</code></pre>\n\n<h1 id=\"desfazendo-o-primeiro-commit-de-um-repositorio\">Desfazendo o primeiro commit de um reposit\u00f3rio</h1>\n<pre><code class=\"Bash\">git update-ref -d HEAD\n</code></pre>\n\n<h1 id=\"undo-a-git-merge\">Undo a git merge</h1>\n<p>From <a href=\"http://stackoverflow.com/questions/2389361/undo-a-git-merge\">Undo a git merge</a> :</p>\n<pre><code class=\"Bash\">git reset --hard commit_sha\n# ou\ngit reset --hard HEAD~5 #will get you back 5 commits.\n# ou\ngit reset --merge ORIG_HEAD\n</code></pre>\n\n<h2 id=\"how-to-revert-a-merge-that-is-already-pushed-to-remote\">How to revert a merge that is already pushed to remote?</h2>\n<p>From this <a href=\"http://stackoverflow.com/questions/7099833/how-to-revert-a-merge-commit-thats-already-pushed-to-remote-branch\">StackOverflow hint</a>:</p>\n<pre><code>git revert merge_sha -m [1,2]\n</code></pre>\n<p>To discover if you have to use 1 or 2 do a <code>git log</code> on the merge_sha, then 1 will represent the left SHA and 2 the right SHA that appear in the 'Merge' line.</p>\n<h1 id=\"removing-sensitive-files-from-old-commits\">Removing sensitive files from old commits</h1>\n<p>From <a href=\"https://help.github.com/articles/remove-sensitive-data/\">Remove sensitive data - User Documentation</a>:</p>\n<pre><code>git filter-branch --force --index-filter 'git rm --cached --ignore-unmatch PATH-TO-YOUR-FILE-WITH-SENSITIVE-DATA' --prune-empty --tag-name-filter cat -- --all\n</code></pre>\n<p>Then, to remove the newly generated 'refs/original' reference and clear the reflog and do a garbage collect:</p>\n<pre><code>git for-each-ref --format='delete %(refname)' refs/original | git update-ref --stdin\ngit reflog expire --expire=now --all\ngit gc --prune=now\n</code></pre>", 
    "url": "/git/undoing/", 
    "language": "en", 
    "title": "Undoing Mistakes"
}