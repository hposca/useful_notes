<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Undoing Mistakes - Anotações</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Undoing Mistakes";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Anotações</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../amazon/">Amazon</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../banco_de_dados/">Banco de dados</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../benchmarks/">Benchmarks</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../bash/">Bash</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../docker/">Docker</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Git</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../git/">General</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../branches/">Branches</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../cleaning/">Cleaning</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../exporting/">Exporting</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../history/">History</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../releasing/">Releasing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../submodules/">Submodules</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Undoing Mistakes</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#find-and-restore-a-deleted-file">Find and restore a deleted file</a></li>
                
            
                <li class="toctree-l3"><a href="#undoing-a-git-rebase">Undoing a git rebase</a></li>
                
                    <li><a class="toctree-l4" href="#desfazendo-o-ultimo-commit">Desfazendo o último commit</a></li>
                
            
                <li class="toctree-l3"><a href="#desfazendo-o-primeiro-commit-de-um-repositorio">Desfazendo o primeiro commit de um repositório</a></li>
                
            
                <li class="toctree-l3"><a href="#undo-a-git-merge">Undo a git merge</a></li>
                
                    <li><a class="toctree-l4" href="#how-to-revert-a-merge-that-is-already-pushed-to-remote">How to revert a merge that is already pushed to remote?</a></li>
                
            
                <li class="toctree-l3"><a href="#removing-sensitive-files-from-old-commits">Removing sensitive files from old commits</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../latex/">Latex</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Linux</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../linux/">General</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../linux/dropbox/">Dropxbox</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../linux/file_handling/">File Handling</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../linux/format_conversions/">Format Conversion</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../linux/logs/">Logs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../linux/tmux/">Tmux</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../linux/youtube/">Youtube</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Python</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/">General</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/virtualenv/">Virtual Environment</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../perl/">Perl</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../ruby/">Ruby</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../vim/">Vim</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Anotações</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Git &raquo;</li>
        
      
    
    <li>Undoing Mistakes</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Undoing mistakes</p>
<h1 id="find-and-restore-a-deleted-file">Find and restore a deleted file</h1>
<p>With the help of <a href="http://stackoverflow.com/questions/953481/find-and-restore-a-deleted-file-in-a-git-repo">StackOverflow</a>:</p>
<p>Find the last commit that affected the given path. As the file isn't in the HEAD commit, this commit must have deleted it.</p>
<pre><code class="bash">git rev-list -n 1 HEAD -- &lt;file_path&gt;
</code></pre>

<p>Then checkout the version at the commit before, using the caret (^) symbol:</p>
<pre><code class="bash">git checkout &lt;deleting_commit&gt;^ -- &lt;file_path&gt;
</code></pre>

<p>Or in one command, if <code>$file</code> is the file in question.</p>
<pre><code class="bash">git checkout $(git rev-list -n 1 HEAD -- &quot;$file&quot;)^ -- &quot;$file&quot;
</code></pre>

<p><strong>HINT:</strong> Use <code>git log --diff-filter=D --summary</code> to get all the commits which have deleted files and the files deleted;</p>
<p><strong>HINT 2:</strong> <a href="http://blog.kablamo.org/2013/12/08/git-restore/">from here</a> How to search the contents of deleted files</p>
<p>Lets say I don’t remember the filename of that file I deleted in a fit of cleanup passion. I do remember the name of one of the functions in it though. Here is how to deal with that. Search the contents of all files that have ever existed in git for a string:</p>
<pre><code class="Bash">git log --summary -S&lt;string&gt; [&lt;path/to/file&gt;] [--since=2009.1.1] [--until=2010.1.1]
</code></pre>

<p>Another way to do this:</p>
<pre><code class="Bash">git rev-list --all | xargs git grep 'string'
</code></pre>

<h1 id="undoing-a-git-rebase">Undoing a git rebase</h1>
<p>Sometimes we want to undo a bad <code>git rebase</code>, hints from <a href="http://stackoverflow.com/questions/134882/undoing-a-git-rebase">StackOverflow</a> :</p>
<ul>
<li>First, we have to discover where is the head commit of the branch as it was immediately before the rebase started in the reflog:</li>
</ul>
<pre><code class="Bash">git reflog
</code></pre>

<p>or</p>
<pre><code class="Bash">git log -g
</code></pre>

<ul>
<li>Then, reset the current branch to it (with the usual caveats about being absolutely sure before reseting with the --hard option):</li>
</ul>
<pre><code class="Bash"># Suppose the old commit was HEAD@{5} in the ref log
git reset --hard HEAD@{5}
</code></pre>

<p><strong>HINT:</strong> Just in case, make a backup first: <code>git tag BACKUP</code>. You can return to it if something goes wrong: <code>git reset --hard BACKUP</code></p>
<h2 id="desfazendo-o-ultimo-commit">Desfazendo o último commit</h2>
<pre><code class="Bash">git reset --soft HEAD~1
</code></pre>

<h1 id="desfazendo-o-primeiro-commit-de-um-repositorio">Desfazendo o primeiro commit de um repositório</h1>
<pre><code class="Bash">git update-ref -d HEAD
</code></pre>

<h1 id="undo-a-git-merge">Undo a git merge</h1>
<p>From <a href="http://stackoverflow.com/questions/2389361/undo-a-git-merge">Undo a git merge</a> :</p>
<pre><code class="Bash">git reset --hard commit_sha
# ou
git reset --hard HEAD~5 #will get you back 5 commits.
# ou
git reset --merge ORIG_HEAD
</code></pre>

<h2 id="how-to-revert-a-merge-that-is-already-pushed-to-remote">How to revert a merge that is already pushed to remote?</h2>
<p>From this <a href="http://stackoverflow.com/questions/7099833/how-to-revert-a-merge-commit-thats-already-pushed-to-remote-branch">StackOverflow hint</a>:</p>
<pre><code>git revert merge_sha -m [1,2]
</code></pre>
<p>To discover if you have to use 1 or 2 do a <code>git log</code> on the merge_sha, then 1 will represent the left SHA and 2 the right SHA that appear in the 'Merge' line.</p>
<h1 id="removing-sensitive-files-from-old-commits">Removing sensitive files from old commits</h1>
<p>From <a href="https://help.github.com/articles/remove-sensitive-data/">Remove sensitive data - User Documentation</a>:</p>
<pre><code>git filter-branch --force --index-filter 'git rm --cached --ignore-unmatch PATH-TO-YOUR-FILE-WITH-SENSITIVE-DATA' --prune-empty --tag-name-filter cat -- --all
</code></pre>
<p>Then, to remove the newly generated 'refs/original' reference and clear the reflog and do a garbage collect:</p>
<pre><code>git for-each-ref --format='delete %(refname)' refs/original | git update-ref --stdin
git reflog expire --expire=now --all
git gc --prune=now
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../latex/" class="btn btn-neutral float-right" title="Latex"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../submodules/" class="btn btn-neutral" title="Submodules"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../submodules/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../latex/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
